---
id: 26
title: 'SMF 1.1 => SMF 2.0'
date: 2011-07-10T17:54:52+00:00
author: hackprime
layout: post
guid: http://zeta.gundam.su/?p=26
categories:
  - it
tags:
  - linux
  - mysql
  - php
  - smf
---

Небольшое руководство о том, как обновить Simple Machune Forum c версии 1.1 (или 1.0) до 2.0.

На сервере имеем: Linux CentOS, nginx 0.98, MySQL 5.1.53, PHP 5.2.

Поехали.

1) Делаем бэкап папки с форумам.

2) Делаем бэкап базы данных.

3) Очищаем таблицы с поисковым кэшем.

```
mysql> USE %database_with_smf_name%
mysql> TRUNCATE TABLE smf_log_search_messages;
mysql> TRUNCATE TABLE smf_log_search_results;
mysql> TRUNCATE TABLE smf_log_search_subjects;
mysql> TRUNCATE TABLE smf_log_search_topics;
```

_Примечание: чтобы не возникло ошибки при обновлении, создайте в каждой из таблиц по одной пустой записи_</li>

4) Теперь, скачиваем с оф.сайта [пакет обновлений SMF 2.0](http://download.simplemachines.org/) (Lagre upgrade). Помимо этого стоит скачать нужные языковые паки ([русский](http://download.simplemachines.org/?smflanguages;lang=russian)). Распаковываем и перемешиваем. Готовую «смесь» загружаем на сервер в директорию с форумом (с перезаписью существующих файлов).

5) Запускаем в браузере скрипт http://domain.com/path\_to\_smf/upgrade.php, и, следуя указаниям, обновляем форум.

* _Примечание 1: в случае, если в корне форумной директории присутствует файл установки (install.php), то вас автоматически перенаправит на него. Для апгрейда форума удалите файл установки._

* _Примечание 2: для UNIX-подобных систем &#8212; файл /Settings.php и директория /cache/должны быть доступны для записи всем._

Возможные ошибки:

1) После обновления, при попытки зайти на форум, появится надпись &#171;Невозможно загрузить &#8216;main&#8217; шаблон.&#187;. Это означает, что по какой-то причине дирректория с темой форума по умолчанию пропала из /Themes/, просто верните её на место (Мы же сделали бэкапы, правильно?) и всё заработает.

2) Весь кириллистический текст, полученный из базы данных, будет похож на квадратики или на знаки вопросов в тёмных ромбиках. Это означает, что где-то ломается исходная кодировка.

Сначала идём в базу данных, в таблицу smf\_settings, и ищем там строку, у которой поле variable равняется &#8216;global\_character_set&#8217;. Если его там нет, то вставляем строку с таким параметром, где в поле value записываем &#8216;UTF-8&#8217; (Мы же всегда используем UTF-8, правда?).

Теперь проверяем форум. Если русские буквы в названии тем видны &#8212; обновление завершено, поздравляю. Если нет&#8230; используем brute force!

Открываем файл /Sources/Subs-Db-mysql.php. Находим функцию smf\_db\_initiate и в самый её конец, перед оператором return, вставляем одну строку:

```
@mysql_query("SET NAMES UTF8", $connection);
```

* [mysql_query](http://www.php.net/mysql_query)

Сохраняем. Проверяем форум &#8212; всё работает.

Источники:

1. [Официальное руководство на английском языке](http://docs.simplemachines.org/index.php?board=3.0;sort=subject)
2. [Обновление smf 1.0.\*, smf 1.1.\* -SMF 2.0 &#8212; Тема на русскоязычном форуме SMF](http://www.simplemachines.ru/index.php?topic=2910)
3. [Upgrade SMF 1.1.8 to SMF 2.0 RC3](http://unixadmins.su/index.php?topic=634.0)
